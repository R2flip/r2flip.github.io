<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>GAINcku åœ–ç‰‡è¼ªæ’­ï¼ˆå…©è¡Œå­—å¹•ï¼‹é»åœ–æš«åœï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style type="text/css">
  * { margin: 0; padding: 0; box-sizing: border-box; }

  html, body {
    height: 100%;
  }

  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    /* ä¸Šæ·±ä¸‹æ·ºçš„å†·è‰²ç³»èƒŒæ™¯ */
    background: linear-gradient(
      180deg,
      #1f2937 0%,
      #e5ecff 55%,
      #f9fbff 100%
    );
    color: #0f172a;
  }

  /* ===== æ•´é«”å·¦å³æ¡†æ¶ ===== */
  .layout {
    display: flex;
    height: 100vh;
    width: 100%;
  }

  /* å·¦å´ï¼šè¼ªæ’­å€ï¼ˆæ¯”è¼ƒå¯¬ï¼‰ */
  .left-pane {
    flex: 2.5;                /* å·¦ 60% */
    min-width: 420px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
  }

  /* å³å´ï¼šSprout äº®é» + iframeï¼ˆç™½åº•å†·è‰²ç³»ï¼‰ */
  .right-pane {
    flex: 2.5;
    min-width: 360px;
    display: flex;
    flex-direction: column;
    border-left: 1px solid rgba(148,163,184,0.35);
    background: #f8fafc;  /* æ·ºå†·è‰²ç³» */
  }

  .sprout-header {
    padding: 16px 20px;
    font-size: 1.2rem;
    font-weight: 700;
    border-bottom: 1px solid rgba(148,163,184,0.35);
    background: linear-gradient(90deg, #2563eb, #38bdf8);
    color: #ffffff;
  }

  .iframe-container {
    flex: 1;
    overflow: hidden;
    background: #ffffff;
  }

  .sprout-iframe {
    width: 100%;
    height: 100%;
    border: none;
  }

  /* ===== è¼ªæ’­å€ ===== */
  .slider-wrapper {
    width: 100%;
    max-width: 960px;
    padding: 16px;
    margin: 0 auto;
  }

  .slider {
    position: relative;
    border-radius: 20px;
    overflow: hidden;
    background: #000;
    box-shadow: 0 18px 40px rgba(15,23,42,0.35);
  }

  /* 1280x720 â†’ 16:9 åœ–ç‰‡æ¡† */
  .slides {
    position: relative;
    width: 100%;
    height: 0;
    padding-top: 56.25%;
    background: #000;
    cursor: pointer; /* æç¤ºå¯é»æ“Šæš«åœ */
  }

  .slide {
    position: absolute;
    inset: 0;
    opacity: 0;
    transition: opacity 0.5s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #000;
  }

  .slide.active {
    opacity: 1;
    z-index: 2;
  }

  .slide img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    background: #000;
    display: block;
  }

  /* å­—å¹•å€ï¼šæ”¹ç‚ºç™½ï¼å†·è‰²èª¿ */
  .caption-area {
    width: 100%;
    background: #f8fafc;
    padding: 12px 18px 16px;
    border-top: 1px solid #e2e8f0;
    color: #0f172a;
  }

  .caption-inner {
    max-width: 90%;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .caption-title {
    font-size: 1.05rem;
    font-weight: 700;
    margin-bottom: 2px;
    color: #0f172a;
  }

  .caption-text {
    font-size: 0.9rem;
    line-height: 1.6;
    color: #475569;
  }

  /* ä¸Šä¸€å¼µ / ä¸‹ä¸€å¼µ */
  .nav-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 38px;
    height: 38px;
    border-radius: 999px;
    border: none;
    background: rgba(15,23,42,0.9);
    color: #e5e7eb;
    cursor: pointer;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    box-shadow: 0 8px 18px rgba(15,23,42,0.6);
    transition: background 0.2s ease, transform 0.2s ease;
  }

  .nav-arrow:hover {
    background: rgba(59,130,246,0.95);
    transform: translateY(-50%) scale(1.05);
  }

  .nav-arrow.prev { left: 10px; }
  .nav-arrow.next { right: 10px; }

  /* é»é»æŒ‡ç¤ºå™¨ */
  .dots {
    position: absolute;
    left: 0;
    right: 0;
    bottom: 10px;
    display: flex;
    justify-content: center;
    gap: 8px;
    z-index: 9;
  }

  .dot {
    width: 9px;
    height: 9px;
    border-radius: 999px;
    background: rgba(148,163,184,0.55);
    cursor: pointer;
    transition: width 0.2s ease, background 0.2s ease, box-shadow 0.2s ease;
  }

  .dot.active {
    width: 26px;
    background: linear-gradient(90deg, #38bdf8, #818cf8);
    box-shadow: 0 0 10px rgba(129,140,248,0.85);
  }

  /* æ¡†å¤–å·¦ä¸‹è§’çš„å°æ–‡å­—é€£çµå®¹å™¨ */
  .caption-toggle-row {
    margin-top: 4px;
    padding: 0 4px;
    display: flex;
    justify-content: flex-start; /* é å·¦ */
  }

  /* å°å°æ–‡å­—é€£çµï¼šé¡¯ç¤º / éš±è—å­—å¹• */
  .caption-toggle {
    border: none;
    background: transparent;
    padding: 0;
    margin: 0;
    font-size: 0.8rem;
    color: #64748b;
    cursor: pointer;
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .caption-toggle:hover {
    color: #1e293b;
  }

  /* æ‰‹æ©Ÿï¼šæ”¹æˆä¸Šä¸‹å †ç–Šï¼Œåº•è‰²ä»ç¶­æŒå†·è‰²ç³» */
  @media (max-width: 900px) {
    .layout {
      flex-direction: column;
      height: auto;
      min-height: 100vh;
    }
    .left-pane, .right-pane {
      min-width: 100%;
    }
    .left-pane {
      padding: 16px;
      order: 1;
    }
    .right-pane {
      order: 2;
      height: 50vh;
    }
  }

  @media (max-width: 768px) {
    .slider-wrapper { padding: 10px; }

    .caption-inner {
      max-width: 96%;
    }

    .caption-title {
      font-size: 1rem;
    }

    .caption-text {
      font-size: 0.82rem;
    }

    .nav-arrow {
      width: 32px;
      height: 32px;
      font-size: 18px;
    }
  }
</style>

<script src="https://code.jquery.com/jquery-3.6.1.min.js"
        integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous">
</script>
	
<script>
    let pageviewUrl = location.pathname;
    // å¾ Google Apps Script å–å¾—è¨ˆæ•¸
    let apiUrl = "https://script.google.com/macros/s/AKfycbycPAPD3JRzL2TLfT5u8doN1g_3j8s5HdCOidvSuJ8WIrM1VLFChyMHVfWFYgdfJkQ/exec";

    $.ajax({
      url: apiUrl + "?url=" + encodeURIComponent(pageviewUrl),
      type: "GET",
      dataType: "json",
      success: function (res) {
        for (let i of res) {
          if (i[0] === pageviewUrl) {
            $("#pageviewUrl").text(pageviewUrl);
            $("#pv").text(i[1]);
          }
        }
      },
      error: function () {
        console.log("è®€å–å¤±æ•—");
      }
    });
</script>	

  
</head>

<body>
  <div class="layout">
    <!-- å·¦å´ï¼šè¼ªæ’­ -->
    <div class="left-pane">
      <div class="slider-wrapper">
        <div class="slider" id="slider">
          <!-- ä¸Šæ–¹ï¼šåœ–ç‰‡è¼ªæ’­æ¡†ï¼ˆ16:9ï¼‰ -->
          <div class="slides" id="slides"></div>

          <!-- ä¸Šæ–¹åœ–ç‰‡ä¸Šçš„å·¦å³ç®­é ­èˆ‡é»é» -->
          <button class="nav-arrow prev" id="prevBtn" type="button">â®</button>
          <button class="nav-arrow next" id="nextBtn" type="button">â¯</button>

          <div class="dots" id="dots"></div>

          <!-- ä¸‹æ–¹ï¼šåœ¨æ¡†å¤–çš„å…©è¡Œå­—å¹•å€ -->
          <div class="caption-area" id="captionArea">
            <div class="caption-inner">
              <div class="caption-title" id="captionTitle"></div>
              <div class="caption-text" id="captionText"></div>
            </div>
          </div>
        </div>

        <!-- å·¦ä¸‹è§’å°æ–‡å­—é€£çµï¼šé¡¯ç¤º / éš±è—å­—å¹• -->
        <div class="caption-toggle-row">
          <button class="caption-toggle" id="captionToggle" type="button">é¡¯ç¤ºå­—å¹•</button>
        </div>
      </div>
    </div>

    <!-- å³å´ï¼šSprout äº®é» + iframe -->
    <div class="right-pane">
      <div class="sprout-header">
        Sprout äº®é»
      </div>
      <div class="iframe-container">
        <iframe
          class="sprout-iframe"
          src="https://script.google.com/a/macros/gs.ncku.edu.tw/s/AKfycbzhGFjxVWPXfcjOr_ZOs5_RVX-FZxKGm-x58r6M6Yh-mhn23WrRxKJ3xnpU56UC1V3H/exec">
        </iframe>
      </div>
    </div>
  </div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // ================================
    // DOM å–å¾—
    // ================================
    const slider = document.getElementById("slider");
    const slidesContainer = document.getElementById("slides");
    const dotsContainer = document.getElementById("dots");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const captionToggleBtn = document.getElementById("captionToggle");
    const captionTitleEl = document.getElementById("captionTitle");
    const captionTextEl = document.getElementById("captionText");
    const captionArea = document.getElementById("captionArea");

    // ================================
    // ç‹€æ…‹è®Šæ•¸
    // ================================
    let slidesData = [];       // ğŸ”¸ æ”¹æˆç”±è©¦ç®—è¡¨è¼‰å…¥
    let currentIndex = 0;
    let autoPlayTimer = null;
    const intervalMs = 6000;

    // ğŸ”» é è¨­å­—å¹•é–‹å•Ÿ
    let captionsVisible = true;
    let pausedByClick = false; // æ˜¯å¦è¢«ã€Œé»æ“Šåœ–ç‰‡ã€æš«åœ

    // ================================
    // å¾ GAS Web App æŠ“è³‡æ–™
    // ================================
    function loadSlidesFromSheet() {
      // â¬‡ï¸ è«‹æŠŠé€™è£¡æ›æˆä½ å‰›å‰›éƒ¨ç½² Web App çš„ç¶²å€
      const apiUrl = "https://script.googleusercontent.com/a/macros/gs.ncku.edu.tw/echo?user_content_key=AehSKLhum0p4L5Y61agcf71-fJ_Na0cNn2FaPSqencVE-FUDSXShRNCIsOZvG8YrQZrJJnBydTng9kPae1l-CHl2cp52WKhum-9iHA27VvPtbxqO7_20e2O2w8QZcVte02dpgupF1sP3eoP-t_SyOWc0XHvfJHNSBQU67g6cZCf9Ni5jibhIq2Cm79vvNZYrgtcfTqO167R39nsGmGA2fMRek-oh1SiairHVlG1Q8nhY76DhOz0XmyiesB4ebeDgGaA7VbiNwmc2JurOLvkLZXmZd8VhN_mFlAMU70WpB-AZbXQ8AUkDCZhCxtpPzHC5hA&lib=MnhiRxy21wa4SPoBevD6-9kbrEVN5BNya";

      fetch(apiUrl)
        .then(function (res) {
          if (!res.ok) {
            throw new Error("HTTP " + res.status);
          }
          return res.json();
        })
        .then(function (data) {
          // data æ‡‰è©²æ˜¯ [{image, title, text}, ...]
          if (!Array.isArray(data) || data.length === 0) {
            console.warn("slidesData ç‚ºç©ºï¼Œè«‹æª¢æŸ¥è©¦ç®—è¡¨è³‡æ–™");
            return;
          }
          slidesData = data;
          initSlider();
        })
        .catch(function (err) {
          console.error("è¼‰å…¥ slides å¤±æ•—ï¼š", err);
        });
    }

    // ================================
    // åˆå§‹åŒ–è¼ªæ’­
    // ================================
    function initSlider() {
      // æ¸…ç©ºèˆŠçš„
      slidesContainer.innerHTML = "";
      dotsContainer.innerHTML = "";
      currentIndex = 0;
      pausedByClick = false;

      createSlides();
      updateCaptionToggleLabel();
      applyCaptionVisibility();
      startAutoPlay();
    }

    // å»ºç«‹ slides + dots
    function createSlides() {
      slidesData.forEach((item, idx) => {
        const slide = document.createElement("div");
        slide.className = "slide" + (idx === 0 ? " active" : "");
        slide.dataset.index = idx;

        const img = document.createElement("img");
        img.src = item.image;
        img.alt = item.title || ("slide " + (idx + 1));
        slide.appendChild(img);

        slidesContainer.appendChild(slide);

        const dot = document.createElement("div");
        dot.className = "dot" + (idx === 0 ? " active" : "");
        dot.dataset.index = idx;
        dot.addEventListener("click", (e) => {
          e.preventDefault();
          e.stopPropagation();
          goToSlide(idx);
          restartAutoPlay();
        });
        dotsContainer.appendChild(dot);
      });

      // åˆå§‹åŒ–å­—å¹•å…§å®¹
      updateCaptionContent(0);
    }

    // æ›´æ–°å­—å¹•
    function updateCaptionContent(index) {
      const data = slidesData[index];
      captionTitleEl.textContent = data ? (data.title || "") : "";
      captionTextEl.textContent = data ? (data.text || "") : "";
    }

    // è¼ªæ’­åˆ‡æ›
    function updateActiveSlide() {
      const slides = document.querySelectorAll(".slide");
      const dots = document.querySelectorAll(".dot");

      slides.forEach((s, i) => s.classList.toggle("active", i === currentIndex));
      dots.forEach((d, i) => d.classList.toggle("active", i === currentIndex));

      updateCaptionContent(currentIndex);
    }

    function goToSlide(idx) {
      const total = slidesData.length || 1;
      currentIndex = (idx + total) % total;
      updateActiveSlide();
    }

    function nextSlide() {
      goToSlide(currentIndex + 1);
    }

    function prevSlide() {
      goToSlide(currentIndex - 1);
    }

    // è‡ªå‹•æ’­æ”¾
    function startAutoPlay() {
      if (autoPlayTimer) return;
      autoPlayTimer = setInterval(nextSlide, intervalMs);
    }

    function stopAutoPlay() {
      if (autoPlayTimer) {
        clearInterval(autoPlayTimer);
        autoPlayTimer = null;
      }
    }

    function restartAutoPlay() {
      if (pausedByClick) return; // è‹¥æ˜¯ä½¿ç”¨è€…é»æ“Šæš«åœï¼Œä¸è¦è‡ªå‹•é‡å•Ÿ
      stopAutoPlay();
      startAutoPlay();
    }

    // ä¸Šä¸€å¼µ / ä¸‹ä¸€å¼µæŒ‰éˆ•
    if (prevBtn) {
      prevBtn.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        prevSlide();
        restartAutoPlay();
      });
    }

    if (nextBtn) {
      nextBtn.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        nextSlide();
        restartAutoPlay();
      });
    }

    // æ»‘é¼ ç§»å…¥ï¼šæš«åœï¼›ç§»å‡ºï¼šè‹¥ä¸æ˜¯é»æ“Šæš«åœï¼Œå°±æ¢å¾©
    if (slider) {
      slider.addEventListener("mouseenter", () => {
        if (!pausedByClick) stopAutoPlay();
      });

      slider.addEventListener("mouseleave", () => {
        if (!pausedByClick) startAutoPlay();
      });
    }

    // é»é¸åœ–ç‰‡ï¼šåˆ‡æ› æš«åœ / ç¹¼çºŒ
    if (slidesContainer) {
      slidesContainer.addEventListener("click", () => {
        if (pausedByClick) {
          pausedByClick = false;
          startAutoPlay();
        } else {
          pausedByClick = true;
          stopAutoPlay();
        }
      });
    }

    // å­—å¹•é¡¯ç¤º / éš±è—ï¼ˆæ•´å€ä¸€èµ·ï¼‰
    function updateCaptionToggleLabel() {
      captionToggleBtn.textContent = captionsVisible ? 'éš±è—å­—å¹•' : 'é¡¯ç¤ºå­—å¹•';
    }

    function applyCaptionVisibility() {
      captionArea.style.display = captionsVisible ? "block" : "none";
    }

    if (captionToggleBtn) {
      captionToggleBtn.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        captionsVisible = !captionsVisible;
        applyCaptionVisibility();
        updateCaptionToggleLabel();
      });
    }

    // âœ… ä¸€é–‹å§‹å°±å¾è©¦ç®—è¡¨è¼‰å…¥è³‡æ–™
    loadSlidesFromSheet();
  });
</script>

</body>
</html>


