<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>新增計畫</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f0f2f5;
      display: flex;
      justify-content: center;
      padding: 50px;
    }

    form {
      background-color: #fff;
      padding: 30px 40px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      width: 450px;
    }

    h2 {
      text-align: center;
      color: #333;
      margin-bottom: 30px;
      font-weight: 500;
    }

    label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      font-weight: 500;
      color: #555;
    }

    select, input {
      width: 60%;
      padding: 7px 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
      transition: all 0.2s;
    }

    select:focus, input:focus {
      border-color: #4CAF50;
      box-shadow: 0 0 5px rgba(76, 175, 80, 0.4);
      outline: none;
    }

    .button-group {
      display: flex;
      justify-content: space-between;
      margin-top: 25px;
    }

    button {
      width: 48%;
      padding: 10px 0;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: 0.3s;
    }

    button[type="submit"] {
      background-color: #4CAF50;
      color: white;
    }

    button[type="submit"]:hover {
      background-color: #45a049;
    }

    button[type="button"] {
      background-color: #ccc;
      color: #333;
    }

    button[type="button"]:hover {
      background-color: #b3b3b3;
    }
  </style>
</head>
<body>
  <form id="projectForm">
    <h2>新增計畫</h2>

    <label>計畫年度
      <select name="計畫年度" id="yearSelect" required></select>
    </label>

    <label>經費來源
      <select name="經費來源" id="sourceSelect"></select>
    </label>

    <label>執行機構
      <select name="執行機構" id="orgSelect"></select>
    </label>

    <label>執行學系
      <select name="執行學系" id="deptSelect"></select>
    </label>

    <label>主持人
      <input type="text" name="主持人" required>
    </label>

    <label>挹注方案
      <select name="挹注方案" id="planSelect"></select>
    </label>

    <label>計畫期程
      <select name="計畫期程" id="durationSelect"></select>
    </label>

    <label>補助金額
      <input type="number" name="補助金額">
    </label>

    <label>CoPI
      <input type="text" name="CoPI">
    </label>

    <div class="button-group">
      <button type="submit">新增</button>
      <button type="button" onclick="projectForm.reset()">清空</button>
    </div>
  </form>

  <script>
    // 下拉選單資料
    const optionsData = {
      years: ["112", "113", "114", "115"],
      sources: ["深耕計畫/捐贈款", "深耕計畫/捐贈款-研發處"],
      orgs: ["文學院", "理學院", "管理學院","工學院","電機資訊學院","社會科學院","規劃與設計學院","生物科學與科技學院", "醫學院","敏求智慧運算學院","智慧半導體及永續製造學院","教務處","學務處"],
      depts: {
      "文學院": ["","中文系","外文系","歷史系","台文系","藝術研究所","考古所","戲劇碩士學位學程","華語中心","外語中心","多元文化研究中心"],
      "理學院": ["","數學系", "化學系", "物理系", "地球科學系", "光電系", "太空與電漿科學研究所", "理論科學研究中心"],
      "管理學院": ["","會計學系暨財務金融研究所","統計學系","企管系","交管系","電信管理研究所","國企所","體健休所","工資管系暨資管所","數據科學研究所","高階管理碩士在職專班(EMBA)","國際經營管理研究所(IMBA)","經營管理碩士學位學程(AMBA)","高階經營管理博士學位學程(DBA)"],
      "工學院": ["","機械系","化工系","土木系","材料系","水利系","工科系","系統系","航太系","資源工程學系","環工系","醫工系","測量系","海洋科技與事務研究所","民航研究所","太空系統工程研究所","能源工程國際學位學程","尖端材料國際碩士學位學程","自然災害減災及管理國際碩士學位學程","工程管理碩士在職專班","醫療器材創新國際碩士班","智慧製造國際碩士學位學程"],
	    "電機資訊學院": ["","電機系","資訊工程學系","醫學資訊研究所","微電子工程研究所","製造資訊與系統研究所","電腦與通信工程研究所","奈米機體電路工程碩士學位學程","智慧資訊安全碩士學位學程"],
	    "社會科學院": ["","政治系","經濟系","法律系","心理系","教育研究所","心智影像研究中心"],
	    "規劃與設計學院": ["","建築系","都計系","工設系","創產所","科技藝術碩士學位學程"],	
	    "生物科學與科技學院": ["","生命科學系","生物科技與產業科學系","熱植所","轉譯農業科學博士學位學程"],
	    "醫學院": ["","藥學系","護理學系","牙醫學系","物治系","職治系","醫檢系","公共衛生學系","臨藥所","基醫所","行醫所","分醫所","口腔醫學研究所","臨醫所","健照所","老年所","食安所","醫學系-基礎醫學科-解剖所","醫學系-基礎醫學科-生化所","醫學系-基礎醫學科-生理所","醫學系-基礎醫學科-微生物學科暨微生物及免疫學研究所","醫學系-基礎醫學科-藥理學科暨藥理學研究所","醫學系-基礎醫學科-寄生蟲學科","醫學系-基礎醫學科-工業衛生學科暨環境醫學研究所","醫學系-基礎醫學科-人文暨社會醫學科","醫學系-臨床醫學學科-病理學科","醫學系-臨床醫學學科-內科學科","醫學系-臨床醫學學科-外科學科","醫學系-臨床醫學學科-小兒學科","醫學系-臨床醫學學科-婦產學科","醫學系-臨床醫學學科-骨科學科","醫學系-臨床醫學學科-神經學科","醫學系-臨床醫學學科-精神學科","醫學系-臨床醫學學科-眼科學科","醫學系-臨床醫學學科-耳鼻喉學科","醫學系-臨床醫學學科-皮膚學科","醫學系-臨床醫學學科-泌尿學科","醫學系-臨床醫學學科-麻醉學科","醫學系-臨床醫學學科-復健學科","醫學系-臨床醫學學科-影像醫學科","醫學系-臨床醫學學科-家庭醫學科","醫學系-臨床醫學學科-急診學科","醫學系-臨床醫學學科-職業及環境醫學科","醫學系-臨床醫學學科-腫瘤醫學科","醫學系-臨床醫學學科-高齡醫學科"],
	    "敏求智慧運算學院": ["","智慧科技系統碩士學位學程","智慧運算碩士學位學程","智慧運算工程博士學位學程"],
	    "智慧半導體及永續製造學院": ["","晶片設計學位學程","半導體製程學位學程","半導體封測學位學程","關鍵材料學位學程","智慧與永續製造學位學程","半導體高階管理暨研發碩士在職專班"],
	    "教務處": ["","師培中心","體育室"],
	    "學務處": ["","心輔組"]
      },
      plans: ["方案A", "方案B", "方案C"],
      durations: ["半年", "一年", "兩年"]
    };

    function populateSelect(id, arr) {
      const sel = document.getElementById(id);
      sel.innerHTML = "";
      arr.forEach(item => {
        const opt = document.createElement("option");
        opt.value = item;
        opt.textContent = item;
        sel.appendChild(opt);
      });
    }

    function initSelects() {
      populateSelect("yearSelect", optionsData.years);
      populateSelect("sourceSelect", optionsData.sources);
      populateSelect("orgSelect", optionsData.orgs);
      populateSelect("planSelect", optionsData.plans);
      populateSelect("durationSelect", optionsData.durations);

      // 預設選擇第一個執行機構
      const firstOrg = optionsData.orgs[0];
      populateSelect("deptSelect", optionsData.depts[firstOrg]);
    }

    window.onload = initSelects;

    // 執行機構聯動學系
    document.getElementById("orgSelect").addEventListener("change", function() {
      const selectedOrg = this.value;
      populateSelect("deptSelect", optionsData.depts[selectedOrg]);
    });

    const apiUrl = "https://script.google.com/macros/s/AKfycbzDBJ3X7whZCDO6Q8_gawauEYHN2o-Z89qpL9rSMUotzpD2OtE0Mlt07hAd8PwRBxbkRg/exec";

    // 表單提交
    document.getElementById("projectForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const formData = Object.fromEntries(new FormData(this).entries());

      fetch(apiUrl, {
        method: "POST",
        body: JSON.stringify(formData)
      })
      .then(res => res.json())
      .then(() => {
        alert("新增成功！");
        this.reset();
        // 可呼叫 searchProjects() 更新列表
      })
      .catch(() => alert("新增失敗！"));
    });
  </script>
</body>
</html>
