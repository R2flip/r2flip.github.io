<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>新增計畫測試</title>
<style>
body { font-family:"Microsoft JhengHei", sans-serif; margin:20px; }
label { display:block; margin:6px 0 2px; }
input { width:300px; padding:6px; }
button { padding:6px 12px; margin-top:8px; background:#0066cc; color:#fff; border:none; border-radius:4px; cursor:pointer; }
button:hover { background:#004999; }
pre { background:#f0f0f0; padding:10px; }
</style>
</head>
<body>

<h2>新增計畫資料</h2>
<form id="projectForm">
  <label>計畫年度 <input type="text" name="計畫年度" required></label>
  <label>經費來源 <input type="text" name="經費來源"></label>
  <label>執行機構 <input type="text" name="執行機構"></label>
  <label>執行學系 <input type="text" name="執行學系"></label>
  <label>主持人 <input type="text" name="主持人" required></label>
  <label>挹注方案 <input type="text" name="挹注方案"></label>
  <label>計畫期程 <input type="text" name="計畫期程"></label>
  <label>補助金額 <input type="number" name="補助金額"></label>
  <label>CoPI <input type="text" name="CoPI"></label>
  <button type="submit">新增</button>
</form>

<h2>新增結果</h2>
<pre id="result"></pre>

<script>
document.addEventListener("DOMContentLoaded", function(){
  const apiUrl = "https://script.google.com/macros/s/AKfycbzDBJ3X7whZCDO6Q8_gawauEYHN2o-Z89qpL9rSMUotzpD2OtE0Mlt07hAd8PwRBxbkRg/exec"; // 🔑 替換你的 Web App URL

  document.getElementById("projectForm").addEventListener("submit", function(e){
    e.preventDefault();
    const data = Object.fromEntries(new FormData(this));
    console.log("送出資料:", data);

    fetch(apiUrl, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then(res => {
      console.log(res);
      if(res.status === "success"){
        alert("新增成功！");
        this.reset();
        document.getElementById("result").textContent = JSON.stringify(res.data, null, 2);
      } else {
        alert("新增失敗：" + (res.message || res.status));
      }
    })
    .catch(err => {
      console.error(err);
      alert("新增失敗：" + err);
    });
  });
});
</script>

</body>
</html>
